<html>
    <head>
        <meta charset="utf-8">
        <title>MicroPython</title>
        <link rel="stylesheet" href="../css/bootstrap.css">
        <link rel="stylesheet" href="../css/pyladies.css">
        <style>
            .part-green  { outline: 2px solid hsla(113, 100%, 50%, 1);
                           background-color:  hsla(113, 100%, 50%, 0.25); }
            .part-cyan   { outline: 2px solid hsla(180, 100%, 50%, 1);
                           background-color:  hsla(180, 100%, 50%, 0.25); }
            .part-blue   { outline: 2px solid hsla(236, 100%, 50%, 1);
                           background-color:  hsla(236, 100%, 50%, 0.25); }
            .part-yellow { outline: 2px solid hsla( 60, 100%, 50%, 1);
                           background-color:  hsla( 60, 100%, 50%, 0.25); }
            .part-orange { outline: 2px solid hsla( 42, 100%, 50%, 1);
                           background-color:  hsla( 42, 100%, 50%, 0.25); }
            .part-red    { outline: 2px solid hsla(  0, 100%, 50%, 1);
                           background-color:  hsla(  0, 100%, 50%, 0.25); }
            .pull-right, .pull-left { margin: 1em; }
            .highlight   { background-color:  hsla(  0, 100%, 50%, 0.1); }
            .img-fluid   { max-width: 100%; }
            .highlight-nocolor{ background-color:  hsla( 60, 100%, 99%, 0.5); }
            .highlight-red    { background-color:  hsla(  0, 100%, 50%, 0.25); }
            .highlight-green  { background-color:  hsla(113, 100%, 50%, 0.25); }
            .highlight-blue   { background-color:  hsla(236, 100%, 50%, 0.25); }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h3 class="text-muted">PyLadies Brno</h3>
            </div>
            <div class="row stuff">
                <div class="col-lg-12">
                    <h1>MicroPython a malé počítače</h1>
                    <div class="note">
                        <strong>Tahle sekce bohužel nejde jednoduše projít z domu.</strong>
                        <br>
                        Využíváme speciální vybavení, které je potřeba nejdřív
                        sehnat. Máš-li možnost se dostat na sraz, nebo
                        aspoň kontaktovat organizátory, doporučujeme shánět
                        spíš tímto způsobem.
                        Případně jde případný hardware objednat přes Internet,
                        typicky z čínských e-shopů.
                    </div>
                    <div class="clearfix">
                        <figure class="well pull-right">
                            <img class="img-fluid" src="nodemcuv3.jpg">
                            <figcaption class="text-center text-xs-right">
                                LoLin NodeMCU v3 – Vývojová deska s čipem ESP8266
                            </figcaption>
                        </figure>
                        <p>
                            Dnes budeme programovat malý počítač – konkrétně
                            tak malý počítač, že se ho pohodlně schováš v ruce.
                            Konkrétně budeme používat „chytrou destičku” zvanou
                            <i>NodeMCU</i>, která by měla ležet před tebou.
                            Než ji vyndáš z obalu, měla by ses <em>vybít</em>:
                            dotkni se něčeho kovového, co je spojeno se zemí,
                            třeba radiátoru nebo kovové části scránky nějakého
                            spotřebiče, který je zapojený do zásuvky.
                            Tím se zbavíš statické elektřiny, která by mohla
                            malinký počítač poškodit.
                            Pak přístroj vyndej z obalu. Snaž se ho držet za
                            hrany a příliš se nedotýkat elektroniky a kovových
                            částí.
                        </p>
                        <p class="note">
                            Obal bude nejspíš roztržený, protože organizátoři
                            do počítače před začátkem kurzu nainstalovali
                            MicroPython.
                        </p>
                        <p>
                            Teď, když malý počítač držíš v ruce, si
                            pojďme projít jeho základní součásti.
                        </p>
                    </div>
                    <div class="clearfix">
                        <img src="nodemcu-popisky.png" class="img-fluid clear clearfix pull-left">
                        <p>
                            Nejdůležitější část našeho počítače je oplechovaná
                            krabička s logem "Wi-Fi" a "FCC":
                            <span class="part-green">mikroprocesor ESP8266</span>.
                            To je „mozek” celého zařízení, který – když je
                            správně naprogramován – umí provádět Pythoní
                            příkazy a programy.
                            Procesor sedí na malé destičce, na které je ještě
                            <span class="part-cyan">anténa</span>, kterou
                            přístroj může komunikovat s okolím.
                        </p>
                        <p>
                            Tahle malá destička se dá použít i samostatně;
                            všechno ostatní, co kolem ní zabírá tolik místa,
                            nám jen ulehčí hraní a umožní s malým počítačem
                            jednoduše komunikovat a krmit ho elektřinou.
                        </p>
                        <p>
                            Komunikace a „krmení” se děje přes
                            <span class="part-red">μUSB konektor</span>,
                            do kterého zapojíš kabel do svého velkého počítače.
                            Když je modul naprogramovaný, stačí ho místo do
                            počítače zapojit do nabíječky či externího zdroje
                            (powerbanky), a bude fungovat samostatně.
                        </p>
                        <p>
                            Kolem USB konektoru jsou dvě tlačítka:
                            <code class="part-orange">RST</code>, kterým se
                            počítač restartuje
                            (jako kdybys ho odpojila a zase zapojila, což se
                            hodí když něco uděláš špatně a počítač „zamrzne”),
                            a <code class="part-yellow">FLASH</code>, o kterém
                            si povíme později.
                        </p>
                        <p>
                            Po stranách modulu jsou dvě řady
                            <span class="part-blue">„nožiček”</span>, na které
                            se dá napojit celá řada nejrůznějších hraček.
                            Zkontroluj si, jestli jsou všechny nožičky rovné;
                            kdyby byla některá ohnutá, tak ji (nejlépe s pomocí
                            kouče) narovnej nebo si vezmi jiný počítač.
                        </p>
                    </div>
                </div>
                <div class="col-lg-12">
                    <h1>Instalace</h1>
                    <p>
                        Bohužel se dnes neobejdeme bez instalace. Musíš naučit
                        svůj velký počítač, aby si povídal s tím malým.
                    </p>
                    <p>
                        Propoj oba počítače přes USB kabel, jako kdybys
                        připojovala třeba mobil.
                    </p>
                    <p class="note">
                        Je potřeba použít kvalitní datový kabel.
                        Nekvalitní kabely (např. spousta kabelů k
                        nabíječkám) jsou často nepoužitelné.
                    </p>
                    <p>
                        Dál postupuj podle operačního systému na svém velkém
                        počítači. Kdyby něco nefungovalo, poraď se s koučem.
                        Původní (anglický) návod k této části je na
                        <a href="http://docs.micropython.org/en/latest/pyboard/pyboard/tutorial/repl.html">stránkách MicroPythonu</a>.
                    </p>
                    <h2>Linux</h2>
                    <div>
                        Nainstaluj příkaz <code>picocom</code> (např.
                        <code>sudo dnf install picocom</code>,
                        <code>sudo apt-get install picocom</code>).
                        Potom spusť:
<pre>
$ sudo picocom -b 115200 /dev/ttyUSB0 
</pre>
                        a stiskni Enter.
                        Měly by se objevit tři zobáčky, <code>&gt;&gt;&gt;</code>.
                    </div>
                    <div>
                        Kdyby to nefungovalo, použij příkaz
                        <code>dmesg | tail</code>, který vypíše něco jako:
<pre>
$ dmesg|tail
[703169.886296] ch341 1-1.1:1.0: device disconnected
[703176.972781] usb 1-1.1: new full-speed USB device number 45 using ehci-pci
[703177.059448] usb 1-1.1: New USB device found, idVendor=1a86, idProduct=7523
[703177.059454] usb 1-1.1: New USB device strings: Mfr=0, Product=2, SerialNumber=0
[703177.059457] usb 1-1.1: Product: USB2.0-Serial
[703177.060474] ch341 1-1.1:1.0: ch341-uart converter detected
[703177.062781] usb 1-1.1: ch341-uart converter now attached to <span class="highlight">ttyUSB0</span>
</pre>
                        V předchozím příkazu pak zaměň <code>ttyUSB</code> za to,
                        co ti tento příkaz ukázal.
                    </div>
                    <div>
                        Nechceš-li pro <code>picocom</code> používat
                        <code>sudo</code>, přidej se do skupiny
                        <code>dialout</code> nebo <code>uucp</code>, podle
                        svého systḿu. Kouč ti kdyžtak poradí.
                    </div>
                    <h2>Windows</h2>
                        <div>
                            MicroPython se přihlásí jako COM port. Otevři
                            správce zařízení, a zjisti který COM port to je
                            (kouč s tím pomůže).
                            Pak si nainstaluj si program
                            <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a>
                            (<code>putty.exe</code>), a spusť ho.
                            V konfiguračním okýnku zaškrtni
                            <em>Connection Type: Serial</em>,
                            do <em>Serial line:</em> zadej svůj COM port,
                            a nastav <em>Speed: 115200</em>.
                            Klikni <em>Open</em>. Mělo by se otevřít
                            okýnko podobné konzoli, kde se, když stiskneš
                            Enter, objeví tři zobáčky:
                            <code>&gt;&gt;&gt;</code>.
                        </div>
                    <h2>Mac</h2>
                        <div>
                            V příkazové řádce zadej:
<pre>
$ screen /dev/tty.usbmodem* 115200
</pre>
                        a stiskni Enter.
                        Měly by se objevit tři zobáčky, <code>&gt;&gt;&gt;</code>.
                    </div>
                </div>
                <div class="col-lg-12">
                    <h1>MicroPython – taky Python</h1>
                    <p>
                        Tak jako máš na velkém počítači nainstalovaný operační
                        systém, na malém počítači je takzvaný <em>firmware</em>,
                        program, který ovládá všechny ty drátky,
                        čipy a světýlka co v počítači jsou.
                        My používáme firmware zvaný <em>MicroPython</em>,
                        který navíc rozumí jazyku Python a umí provádět pythoní
                        příkazy. Zkus si to!
                        Tři zobáčky, které vyskočily v minulém kroku, přišly
                        z malého počítače, který teď netrpělivě čeká na příkaz.
                    </p>
<pre>
>>> 1+1
2
>>> print('Hello World')
Hello World
</pre>
                    <p>
                        Téměř vše, co používáš v Pythonu na velkém počítači,
                        umí MicroPython taky: čísla, řetězce, seznamy, třídy,
                        výjimky, moduly, a tak dál.
                        Některé detaily jsou trochu osekané, aby se všechno
                        vešlo do extrémně malého prostoru.
                        Zkus si, jak se liší efekt následujících příkazů
                        od Pythonu na velkém počítači:
                    </p>
<pre>
>>> print
>>> help(print)
>>> import math
>>> math.pi
</pre>
                    <p>
                        Najdůležitější věc, která je osekaná, je <em>standardní
                        knihovna</em> – většina modulů, které na velkém
                        počítači můžeš naimportovat, v MicroPythonu chybí.
                        U modulů jako <code>turtle</code> je to pochopitelné;
                        ale v rámci šetření místem chybí i moduly jako
                        <code>random</code>.
                        Většinou to příliš nevadí – malé počítače se používají
                        na jiné věci než ty velké – ale je potřeba si na to
                        dát pozor.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Vstup</h1>
                    <p>
                        MicroPython na našem malém počítači obsahuje některé
                        moduly, které jinde nenajdeme. Ten hlavní se jmenuje
                        <code>machine</code>, a dává nám přístup k základním
                        funkcím zařízení. Zkus si:
                    </p>
<pre>
from machine import Pin
pin = Pin(0, Pin.IN)
print(pin.value())
</pre>
                    <p>
                        Zmáčkni a drž tlačítko <code>FLASH</code> vedle USB
                        konektoru. Jak se změní <code>pin.value()</code>?
                    </p>
                    <p>
                        Jak tomuhle kódu rozumět?
                        Třída <code>Pin</code> ti umožňuje ovládat jednotlivé
                        „nožičky”, kterými malý počítač: komunikuje s vnějším
                        světem: buď na nich nastavovat napětí, nebo zkoumat
                        jestli na nich nějaké napětí je.
                    </p>
                    <p>
                        <code>Pin(0, Pin.IN)</code> vytvoří objekt třídy Pin,
                        který bude načítat data z „nožičky” číslo 0.
                        (<code>IN</code> znamená načítání – informace jdou
                        <em>do</em> procesoru).
                        Funkce <code>pin.value()</code> změří napětí na dané
                        „nožičce”, a vrátí buď 1 nebo 0 podle toho,
                        jestli nějaké naměřila.
                    </p>
                    <p>
                        No a „nožička” číslo 0 je připojená k tlačítku
                        <code>FLASH</code>.
                        Informace o tom, která nožička je kam připojená,
                        máš na <a href="https://github.com/pyvec/cheatsheets/raw/master/micropython/nodemcu-cs.pdf">taháku</a> –
                        můžeš si zkontrolovat,
                        že Pin(0) u sebe má poznámku FLASH.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Obvod</h1>
                    <p>
                        Teď na chvíli necháme programování a postavíme si
                        elektrický obvod.
                        Vezmi si modrou svítivou diodu (LED, „světýlko”) a
                        nepájivé pole („hloupou destičku”).
                        Zkusíme světýlko rozsvítit.
                    </p>
                    <p>
                        LED rozsvítíš tak, že ji připojíš ke
                        <em>zdroji napětí</em>,
                        například k baterce.
                    </p>
                    <p>
                        Jako zdroj napětí můžeme použít i náš počítač.
                        Ten bere elektřinu přes USB a dává nám ji k dispozici\
                        na některých svých „nožičkách”:
                        konkrétně plus na nožičce označené <code>3V</code>
                        a mínus na nožičce označené <code>G</code>.
                        Na tyhle nožičky musíš zapojit diodu.
                    </p>
                    <p>
                        Připojování diody má to jeden háček:
                        musíš ji zapojit správným směrem – plus
                        na plus, mínus na mínus.
                        Opačně dioda svítit nebude. Dobrá zpráva je, že
                        když diodu otočíš špatně, nic se jí nestane.
                    </p>
                    <p class="note">
                        Základní vlastnost <em>diody</em> je ta, že pustí
                        elektrický proud jen jedním směrem. Svítící dioda
                        – <em>angl. Light Emitting Diode, LED</em> – ještě k
                        tomu navíc svítí.
                    </p>
                    <p>
                        Je potřeba rozpoznat rozdíl mezi nožičkami diody.
                        <em>Katoda</em> (<code>-</code>) je ta
                        kratší nožička.
                        Pouzdro diody je u katody trochu seříznuté,
                        a vevnitř v pouzdře, když se pozorně podíváš, uvidíš
                        u katody větší plíšek.
                        Té druhé nožičce se říká anoda (<code>+</code>).
                    </p>
                    <p>
                        Tak, teď víš kam diodu zapojit: katodu (kratší nožičku)
                        na <code>G</code>, a anodu na <code>3V</code>.
                    </p>
                    <p>
                        Držení nožiček diody u nožiček počítače by ti nejspíš
                        zaměstnalo obě ruce. Aby sis je uvolnila, použij
                        „Hloupou destičku”: <em>nepájivé pole</em>
                        (angl. <em>breadboard</em>).
                        Je v ní spousta dírek, do kterých se dají strkat dráty.
                        V rámci každé poloviny destičky je každá řada dírek –
                        tedy každá pětice – spojená dohromady.
                        Když zapojíš drátky do stejné řady, spojíš je tím.
                    </p>
                    <p>
                        Zasuň počítač do nepájivého pole. Pak připoj katodu
                        do dírky ve stejné řadě, kde je nožička
                        <code>3V</code> počítače, a podobně anodu k
                        <code>G</codE>.
                        Mělo by to vypadat jako na tomto obrázku:
                    </p>
                    <p>
                        <img src="circuits/led_bb.svg" class="img-fluid"
                            alt="diagram zapojení">
                    </p>
                    <p>
                        Potom zapoj USB kabel. Dioda by se měla rozsvítit!
                    </p>
                    <p>
                        Zkus si, co se stane když obě nožičky diody zapojíš ke
                        <code>G</code>.
                    </p>
                    <p>
                        <img src="circuits/led_bb_off.svg" class="img-fluid"
                            alt="diagram zapojení">
                    </p>
                    <p>
                        Aby dioda svítila, musí být připojená na dvě místa,
                        mezi kterými je takzvaný <em>potenciálový rozdíl</em> —
                        napětí.
                        Na nožičce <code>G</code> máme 0 voltů; na nožičce
                        <code>3V</code> máme 3,3 volty – je tedy mezi nimi
                        rozdíl 3,3 V.
                    </p>
                    <p class="note">
                        Samotná hodnota napětí nedává smysl – napříklat
                        říct, že je na jednom místě 3,3 V je nepřesné.
                        Hodnota ve voltech se vždycky musí k něčemu vztahovat;
                        vyjadřuje rozdíl mezi dvěma místy.
                        V elektronice používáme rozdíl oproti „zemi” – napětí
                        na nožičce <code>G</code>. Stanovíme si že tam je
                        0 voltů, a ostatní napětí počítáme vzhledem k ní.
                        Na nožičce <code>3V</code> je tedy napětí 3,3 V
                        vzhledem k zemi.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Výstup</h1>
                    <p>
                        Proč jsme diodu na to, aby se rozsvítila, připojili
                        k počítači a ne k baterce?
                        Počítač je trošku složitější zařízení než baterka,
                        a jedna důležitá věc, kterou umí, je nastavovat
                        napětí na různých nožičkách.
                        Umí zařídit, aby se nožička chovala jednou jako
                        <code>3V</code> a jindy jako <code>G</code>.
                        Když připojíš diodu mezi <code>G</code> a takovou
                        přepínatelnou nožičku, můžeš nastavit, kdy svítí
                        a kdy ne.
                    </p>
                    <p>
                        Přepoj drát k anodě z <code>3V3</code> na
                        <code>D5</code>.
                    </p>
                    <p>
                        Máš-li zapojeno, znovu se připoj k MicroPythonu a
                        zadej následující kód:
                    </p>
<pre>
from machine import Pin
pin = Pin(14, Pin.OUT)
pin.value(0)
pin.value(1)
</pre>
                    <p>
                        Když objekt Pin vytvoříš s <code>Pin.OUT</code>,
                        MicroPython na něm bude nastavovat napětí –
                        buď 3,3V (<code>value(1)</code>) nebo 0V
                        (<code>value(0)</code>).
                        A tak se dá s diodou blikat.
                    </p>
                    <p class="note">
                        Číslování nožiček je bohužel dvojí – nožička
                        označená jako <code>D5</code> má v procesoru přiřazené
                        číslo 14. Třída <code>Pin</code> v MicroPythonu
                        používá číslování procesoru.
                        Naštěstí máš <a href="https://github.com/pyvec/cheatsheets/raw/master/micropython/nodemcu-cs.pdf">tahák</a>,
                        kde snadno dohledáš že
                        <code>D5</code> a <code>Pin(14)</code> jsou dvě jména
                        stejné nožičky.
                    </p>
                    <p>
                        Zvládneš napsat program, který zařídí, aby dioda
                        svítila když je zmáčknuté tlačítko <code>FLASH</code>,
                        jinak ne?
                    </p>
                    <p class="note">
                        Nápověda: Můžeš pořád dokola zjišťovat stav tlačítka
                        a nastavovat podle něj stav LED.
                    </p>
<details class="solution"><h3>Řešení</h3>
<pre>
from machine import Pin
pin_diody = Pin(14, Pin.OUT)
pin_tlacitka = Pin(0, Pin.IN)
while True:
    pin_diody.value(1 - pin_tlacitka.value())
</pre>
</details>
                </div>
                <div class="col-lg-12">
                    <h1>Triky MicroPythoní konzole</h1>
                    <p>
                        Jak začneš psát trochu složitější programy,
                        mohlo by se stát, že tě konzole MicroPythonu začne
                        trochu štvát. Pojďme tomu předejít.
                        Špatně se v ní opravují chyby a automatické odsazování
                        funguje jen většinou.
                    </p>
                    <p>
                        Doporučuju si větší kousky kódu – a určitě takové,
                        ve kterých je nějaký cyklus, podmínka či funkce –
                        psát vedle do editoru, a pro provedení je vždycky
                        zkopírovat a vložit do konzole.
                    </p>
                    <p>
                        Máš-li v kódu odsazení, zmáčkni před vložením
                        <kbd>Ctrl</kbd>+<kbd>E</kbd>, a po něm
                        <kbd>Ctrl</kbd>+<kbd>D</kbd>.
                        Tím vypneš automatické odsazování, které při vkládání
                        jenom vadí.
                    </p>
                    <p>
                        Možná sis toho už všimla u minulé nekonečné smyčky, ale
                        <kbd>Ctrl</kbd>+<kbd>C</kbd>, funguje jako v Pythonu
                        na velkých počítačích.
                    </p>
                    <p>
                        A dobrá zpráva pro Windowsačky: když zmáčkneš v PuTTY
                        prostřední tlačítko myši, vloží se obsah schránky.
                        Nemusíš tedy, jako v příkazové řádce Windows,
                        vkládat přes menu.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Velice rychle blikat</h1>
                    <p>
                        Jedna z nevýhod „našeho” čipu ESP8266 je, že na svých
                        nožičkách umí nastavovat jen dvě hodnoty – 3,3V a zem,
                        jedničku a nulu.
                        Naše dioda tak buď svítí, nebo nesvítí – nedá se
                        nastavit poloviční intenzita, nedá se
                        plynule rozsvěcet nebo zhasínat.
                    </p>
                    <p>
                        Tuhle nevýhodu ale můžeme obejít s využitím dvou faktů.
                        Ten první je, že diodám – na rozdíl od žárovek nebo
                        zářivek – nevadí, časté vypínání a zapínání.
                        Opotřebovávají se svícením a časem. 
                        Druhý je, že lidské oko nestačí zaznamenat pohyby a
                        změny, které probíhají rychleji než zhruba za
                        setinu vteřiny.
                    </p>
                    <p>
                        Pojďme tedy velice rychle blikat – a oblafnout tak naše
                        oči a mozky!
                        Využijeme k tomu funkci <code>time.sleep()</code>,
                        která počká daný počet vteřin.
                        Třeba <code>time.sleep(1/100)</code> zastaví program
                        na jednu setinu sekundy.
                    </p>
<pre>
from machine import Pin
from time import sleep
pin_diody = Pin(14, Pin.OUT)
while True:
    pin_diody.value(0)
    sleep(1/100)
    pin_diody.value(1)
    sleep(1/200)
</pre>
                    <p>
                        Zkus si pohrát shodnotami pro <code>time.sleep</code>.
                    </p>
                    <p>
                        Dokážeš napsat program, který diodu postupně, plynule
                        rozsvítí?
                    </p>
                     <!-- XXX: Solution? -->
                    <p class="note">
                        Takhle fungují prakticky všechna stmívatelná LED
                        světla – rychlé blikání je ekonomičtější a přesnější
                        než např. nastavování nižšího napětí.
                    </p>
                    <p>
                        Protože je takovéhle rychlé blikání užitečné ve spoustě
                        různých situací, obsahuje náš počítač speciální obvod,
                        který umí blikat samostatně.
                        Nastavíme jak rychle má blikat, a jak dlouho má trvat
                        každé bliknutí, a počítač pak bude blikat automaticky,
                        zatímco náš program se může věnovat něčemu jinému.
                    </p>
                    <p>
                        Téhle funkci se říká <em>pulzně šířkové modulace</em> –
                        <!-- XXX: to je hnusný překlad, já bych řekl „modulace
                        šířky pulzu”, ale je to, zdá se,  technický termín...
                        -->
                        angl. <em>Pulse Width Modulation</em>, neboli
                        <em>PWM</em>.
                        Z MicroPythonu jde tahle funkce ovládat pomocí třídy
                        <code>machine.PWM</code>.
                        Každý objekt téhle třídy umí ovládat jednu nožičku,
                        a dají se u něj nastavit dva parametry:
                    </p>
                    <ul>
                        <li>
                            <code>freq</code> – frekvence, tedy kolikrát za
                            sekundu se LED rozsvítí a zase zhasne, a
                        </li>
                        <li>
                            <code>duty</code> – anglicky <em>duty cycle</em>,
                            česky <em>střída</em>, nastavuje „šířku pulzu”,
                            tedy jak dlouho bude dioda při každém bliknutí
                            svítit.
                            Hodnota <code>duty</code> může být od 0, kdy LED
                            nesvítí vůbec, do 1023, kdy svítí celou dobu.
                            Nastavíš-li <code>duty=512</code>, bude dioda
                            svítit s poloviční intenzitou (512 = 1024/2).
                        </li>
                    </ul>
                    <p>
                        Nastavíš-li <code>PWM(freq=50, duty=512)</code>,
                        dioda bude blikat 50× za sekundu.
                        Vždycky jednu setinu vteřiny bude svítit a na jednu
                        setinu vteřiny zhasne.
                    </p>
<pre>
from machine import Pin, PWM
from time import sleep

pin_diody = Pin(14, Pin.OUT)
pwm = PWM(pin_diody, freq=50, duty=512)
</pre>
                    <p>
                        Zkus nastavit i nižší frekvenci, třeba 3 nebo 1, ať
                        blikání vidíš přímo!
                    </p>
                    <p>
                        PWM se dá zrušit metodou <code>pwm.deinit()</code>.
                        Jako s otvíráním souborů, je dobré po sobě uklidit –
                        i když zatím můžeš jednoduše restartovat celý počítač.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Tóny a melodie</h1>
                    <p>
                        Vezmi si další součástku – piezobudič, neboli
                        „bzučítko”.
                    </p>
                    <p>
                        Tahle malá věc obsahuje speciální materiál, který se,
                        když ho připojíme ke zdroji napětí, trošku roztáhne.
                        Roztažením zatlačí na okolní vzduch, a vytvoří tlakovou
                        vlnu, která může doputovat až k našim uším.
                    </p>
                    <p>
                        Zkus si to – když bzučítko připojíš na <code>3V</code>
                        a <code>G</code> (tentokrát je jedno kterým směrem),
                        uslyšíš tiché lupnutí.
                        A podobné lupnutí uslyšíš když součástku zase odpojíš.
                    </p>
                    <p>
                        Co se stane, když budeš napětí připojovat
                        a odpojovat, řekněme, 32× za vteřinu?
                    </p>
                    <p>
                        Nebo 65×?
                    </p>
                    <p>
                        Nebo některou z těchto frekvencí?
                    </p>
                    <table class="table">
                        <tr><th>Nota</th><th>Frekvence</th></tr>
                        <tr><td>C1 </td><td>32.70 Hz</td></tr>
                        <tr><td>D  </td><td>36.71 Hz</td></tr>
                        <tr><td>E  </td><td>41.20 Hz</td></tr>
                        <tr><td>F  </td><td>43.65 Hz</td></tr>
                        <tr><td>G  </td><td>49.00 Hz</td></tr>
                        <tr><td>A  </td><td>55.00 Hz</td></tr>
                        <tr><td>H  </td><td>61.74 Hz</td></tr>
                        <tr><td>C2 </td><td>65.41 Hz</td></tr>
                    </table>
                    <p>
                        Naprogramuj písničku!
                        Potřebuješ-li víc not, pusť si
                        <a href="noty.py">program</a>, který vypočítá
                        další frekvence.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Další ovládání</h1>
                    <p>
                        Teď si vezmi dvě tlačítka („mačkátka”), a připoj
                        je k počítači:
                        <code>GND</code> vždycky na <code>G</code>,
                        <code>VCC</code> vždycky na <code>3V</code>, a
                        <code>OUT</code> u jednoho tlačítka na <code>D1</code>
                        a u druhého na <code>D2</code>.
                    </p>
                    <p>
                        Tlačítko funguje tak, že OUT spojí buď s VCC (5V)
                        nebo GND, podle toho, jestli je tlačítko stisknuté.
                        (A navíc to taky teda svítí, ale to je teď vedlejší.)
                    </p>
                    <p>
                        Zkus si, jestli se zvládneš MicroPythonu zeptat,
                        jestli je tlačítko zapnuté.
                        Mělo by to být podobné jako u příkladu
                        s tlačítkem FLASH.
                    </p>
                    <p>
                        Zvládneš napsat program, který bude bzučet bzučítkem,
                        a přitom se jedním tlačítkem bude dát zvyšovat tón,
                        a druhým snižovat?
                    </p>
                    <p>
                        Program si (na velkém počítači) ulož, ať se k němu
                        můžeš vrátit.
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Rotace</h1>
                    <p>
                        Čas na další součástku! Tentokrát to bude servomotor,
                        neboli „točítko”.
                    </p>
                    <p>
                        Servomotor je součástka, která má v sobě zabudovaný
                        ovladač, se kterým si náš počítač může povídat
                        jednoduchým „elektronickým jazykem” –
                        <em>protokolem</em>.
                        Točítku budeme posílat impulzy, a podle délky impulzu
                        se servomotor natočí.
                        Při krátkých impulzech se natočí víc na jednu stranu,
                        při dlouhých na druhou.
                        Impulzy musíš posílat neustále, jinak se servomotor
                        vypne.
                    </p>
                    <p>
                        Na rozdíl od bzučítka, kde o výšce tónu rozhodovala
                        frekvence (<code>freq</code>) – kolikrát za vteřinu
                        se ozve lupnutí – a LED, kde o intenzitě rozhodovala
                        střída (<code>duty</code>) – poměr mezi dobou kdy
                        dioda svítí a kdy nesvítí, u servomotoru rozhoduje
                        tzv. <em>šířka pulzu</em>: jak dlouho se napětí udrží
                        na 3,3V, než se přepne zpátky na 0V.
                        <!-- XXX: Actual typical pulse widths -->
                    </p>
                    <p>
                        V praxi to znamená, že můžeme nastavit <code>freq</code>
                        na 50 Hz, a <code>duty</code> měnit cca od 35
                        (úplně vlevo) přes 77 (uprostřed) po 120 (úplně vpravo).
                    </p>
                    <p>
                        Dost ale teorie, pojďme si to vyzkoušet!
                        Napřed musíš motorek zapojit:
                    </p>
                    <ul>
                        <li>
                            hnědý drát (zem) na <code>G</code>,
                        </li>
                        <li>
                            červený drát (napájení) na <code>3V</code>, a
                        </li>
                        <li>
                            oranžový drát (data) na <code>D4</code>.
                        </li>
                    </ul>
                    <p>
                        Nožička <code>D4</code> odpovídá <code>Pin(2)</code>,
                        takže kód k otáčení motorku je:
                    </p>
<pre>
from machine import Pin, PWM
from time import sleep

pin_motorku = Pin(2, Pin.OUT)
pwm = PWM(pin_motorku, freq=50, duty=77)
pwm.duty(35)
</pre>
                    <p>
                        Zkus motorkem otáčet nastavováním <code>duty</code>
                        na 35 do 123.
                        Kdyby se náhodou stalo, že se počítač restartuje a
                        konzole přestane fungovat, zkus ho odpojit a znovu
                        připojit. Kdyby to nepomohlo, motorek ti dneska
                        nebude fungovat. Za chvíli si řekneme proč; zatím
                        se přidej k sousedce :)
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Poznámka o napájení a napětí</h1>
                    <p>
                        K tomu, aby se otočil motor, je potřeba mnohem víc
                        energie, než k rozsvícení světýlka.
                        Z USB z počítače té energie dostaneš docela málo,
                        proto můžou být s motorkem problémy.
                    </p>
                    <p>
                        Jak to řešit, až si přestaneme hrát a budeš chtít
                        motorkem otáčet „doopravdy”?
                    </p>
                    <p>
                        Elektronika, která je na našem malém počítači mimo
                        malou destičku s „mozkem” má dva hlavní úkoly:
                    </p>
                    <ul>
                        <li>
                            Převádět <em>komunikaci</em> z USB, která je
                            celkem složitě zakódovaná, na něco čemu malý
                            počítač rozumí (konkrétně „UART”
                            přes nožičky <code>TX</code> a <code>RX</code>).
                        </li>
                        <li>
                            Převádět napětí 5V, které poskytuje USB,
                            na 3,3V které potřebuje malý počítač.
                        </li>
                    </ul>
                    <p>
                        Když energie z USB přestane stačit, dá se koupit
                        zařízení, které zvládne převádět komunikaci,
                        a napájení vyřešit z jiného zdroje 5V.
                        Kdybys to někdy zkoušela, příslušné zařízení
                        koupíš pod názvem <em>USB-TTL adapter</em>, a vypadá
                        nejčastěji takhle:
                    </p>
                    <img src="usb-ttl.png">
                    <p>
                        K malému počítač pak tento převodník a zdroj napětí
                        připojíš takto:
                    </p>
                    <!-- XXX: obrázek -->
                    <ul>
                        <li>
                            <code>GND</code> na převodníku – <code>G</code> na počítači
                        </li>
                        <li>
                            <code>RX</code> na převodníku – <code>TX</code> (!) na počítači
                        </li>
                        <li>
                            <code>TX</code> na převodníku – <code>RX</code> (!) na počítači
                        </li>
                        <li>
                            <code>+5V</code> na zdroji napětí na <code>VIN</code> na počítači
                        </li>
                        <li>
                            Zem na zdroji napětí na <code>G</code> na počítači
                        </li>
                    </ul>
                    <p>
                        Pozor, 5V nepřipojuj jinam než na <code>VIN</code>!
                    </p>
                    <h2>Napětí</h2>
                    <p>
                        Další důvod, proč nám servomotor někdy nefunguje dobře,
                        je to, že je stavěný na 5 voltů, ne na 3,3 které
                        poskytuje malý počítač.
                    </p>
                    <p>
                        Když připojíš zařízení k menšímu napětí, než
                        potřebuje, většinou buď nebude fungovat, nebo bude
                        dělat „míň” než by mělo: LED bude míň svítit,
                        reproduktor bude tišší, motorek se bude točit pomaleji
                        nebo s menší silou.
                    </p>
                    <p>
                        Když naopak připojíš zařízení k <em>většímu</em> napětí,
                        než na jaké je stavěno, nejspíš ho nadobro zničíš.
                        Když připojíš červenou LED přímo na 3,3 V, přestane
                        fungovat;
                        když připojíš malý servomotorek na zdroj 24V, může
                        začít hořet.
                        A ačkoli lidem malá napětí jako 5V nevadí,
                        když připojíš do zásuvky s 230V sama sebe, můžeš umřít.
                        Takže na velká napětí pozor!
                    </p>
                    <p>
                        My motorek připojujeme na malé napětí, a zmenšený
                        výkon nám příliš nevadí – dokud se to
                        otáčí, víc rychlosti ani síly nepotřebujeme.
                    </p>
                    <p>
                        Až to ale potřebovat budeš – například až budeš
                        servomotorkem pohánět ruku robota, která bude zvedat
                        těžké náklady, budeš potřebovat dvě věci:
                    </p>
                    <ul>
                        <li>
                            Externí napájení – jako předtím bude motorek
                            potřebovat zvláštní zdroj 5V.
                        </li>
                        <li>
                            Na datový signál je potřeba použít <em>převodník
                            úrovní</em> (angl. <em>logic level converter</em>),
                            který převede třívoltový signál na pětivoltový.
                        </li>
                    </ul>
                    <p>
                        Kdybys to někdy potřebovala, ozvi se koučům – i po
                        workshopu ti určitě rádi poradí, nebo ti aspoň řeknou
                        koho se zeptat!
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Ukládání souboru</h1>
                    <div>
                        (XXX: Tahle kapitola ještě bohužel není dopsaná.)
                    </div>
                </div>
                <div class="col-lg-12">
                    <h1>Barevná světýlka</h1>
                    <p>
                        Tak, dost teorie; vem si novou hračku!
                        Tentokrát to bude LED pásek, neboli „blikátko”.
                    </p>
                    <p>
                        Na pásku máš 8 malých čtverečků.
                        Každý z nich obsahuje docela hodně elektroniky:
                        tři barevné LED (červenou, zelenou, a modrou),
                        a čip který je umí ovládat pomocí informací,
                        které dostane přes jediný drátek z malého počítače.
                    </p>
                    <p>
                        Takové pásky se prodávají po metrech, a dají se
                        nastříhat – mezi jednotlivými světýlky si všimni čárky,
                        naznačující kde máš střihnout.
                        Energie z USB stačí zhruba na osm světýlek, proto jsi
                        jich dostala tolik.
                    </p>
                    <p>
                        Tenhle LED pásek je, podobně jako servomotorek, stavěný
                        na pět voltů. Na rozdíl od motorku, který se s 3,3V
                        trochu roztočil, se ale s nižším napětím ani
                        nerozsvítí.
                        Naštěstí ale potřebuje 5V jen na <em>napájení</em>;
                        řídící signál s informacemi o barvičkách může mít
                        3,3V.
                    </p>
                    <p>
                        Pojďme pásek zapojit:
                    </p>
                    <ul>
                        <li>
                            <code>GND</code> pásku (bílý drátek)
                            připoj na <code>G</code>
                        </li>
                        <li>
                            <code>DI</code> (<em>data in</em> – zelený drátek)
                            připoj na <code>D4</code>
                        </li>
                        <li>
                            <code>+5V</code> (červený drátek)
                            připoj na <code>VU</code>
                        </li>
                    </ul>
                    <p>
                        Nožička <code>VU</code> poskytuje 5 voltů.
                        Pozor na ni: nepřipojuj na ni zařízení, které se s
                        pěti volty nevyrovnají.
                    </p>
                    <p>
                        Máš-li zapojeno, můžeš začít programovat.
                        „Jazyk”, kterým „mluví” tenhle LED pásek je trošku
                        složitější než signál PWM, ale MicroPython obsahuje
                        speciální knihovnu, která s páskem komunikovat
                        umí.
                        Vypadá to nějak takhle:
                    </p>
<pre>
from machine import Pin
from neopixel import NeoPixel

POCET_LED = 8
pin = Pin(2, Pin.OUT)
np = NeoPixel(pin, POCET_LED)
np[<span class="highlight-nocolor">0</span>] = (<span class="highlight-red">255</span>, <span class="highlight-green">255</span>, <span class="highlight-blue">255</span>)
np.write()
</pre>
                    <p>
                        Co znamenají vyznačené hodnoty (<code>0</code> a
                        ty <code>255</code>), na to už jistě přijdeš sama.
                        Jen při experimentování nezapomeň zavolat
                        <code>np.write()</code>, tím se informace pošlou do
                        LED pásku.
                    </p>
                    <p>
                        Zvládneš naprogramovat semafor?
                    </p>
                </div>
                <div class="col-lg-12">
                    <h1>Wi-fi</h1>
                    (XXX)
                </div>
                <div class="col-lg-12">
                    <h1>Kam dál?</h1>
                    (XXX)
                </div>
            </div>
            <div class="footer">
                <div>pro PyLadies CZ napsal Petr Viktorin, 2016</div>
                <div>Licence: <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></div>
            </div>
        </div>
        <script type="text/javascript" src="../js/solutions.js"></script>
    </body>
</html>
